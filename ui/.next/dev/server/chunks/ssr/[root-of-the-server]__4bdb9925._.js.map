{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 88, "column": 0}, "map": {"version":3,"sources":["file:///home/blockcode/antigravity/contracts/ui/src/lib/abis.ts"],"sourcesContent":["export const AnonPollABI = [\n  {\n    \"inputs\": [\n      {\n        \"internalType\": \"uint256\",\n        \"name\": \"_pollId\",\n        \"type\": \"uint256\"\n      },\n      {\n        \"internalType\": \"string\",\n        \"name\": \"_questionCID\",\n        \"type\": \"string\"\n      },\n      {\n        \"internalType\": \"uint64\",\n        \"name\": \"_start\",\n        \"type\": \"uint64\"\n      },\n      {\n        \"internalType\": \"uint64\",\n        \"name\": \"_end\",\n        \"type\": \"uint64\"\n      },\n      {\n        \"internalType\": \"uint256\",\n        \"name\": \"optionsCount\",\n        \"type\": \"uint256\"\n      },\n      {\n        \"internalType\": \"address\",\n        \"name\": \"_aggregator\",\n        \"type\": \"address\"\n      }\n    ],\n    \"stateMutability\": \"nonpayable\",\n    \"type\": \"constructor\"\n  },\n  {\n    \"anonymous\": false,\n    \"inputs\": [\n      {\n        \"indexed\": true,\n        \"internalType\": \"bytes32\",\n        \"name\": \"nullifier\",\n        \"type\": \"bytes32\"\n      },\n      {\n        \"indexed\": false,\n        \"internalType\": \"uint256\",\n        \"name\": \"option\",\n        \"type\": \"uint256\"\n      }\n    ],\n    \"name\": \"Voted\",\n    \"type\": \"event\"\n  },\n  {\n    \"inputs\": [],\n    \"name\": \"aggregator\",\n    \"outputs\": [\n      {\n        \"internalType\": \"address\",\n        \"name\": \"\",\n        \"type\": \"address\"\n      }\n    ],\n    \"stateMutability\": \"view\",\n    \"type\": \"function\"\n  },\n  {\n    \"inputs\": [],\n    \"name\": \"end\",\n    \"outputs\": [\n      {\n        \"internalType\": \"uint64\",\n        \"name\": \"\",\n        \"type\": \"uint64\"\n      }\n    ],\n    \"stateMutability\": \"view\",\n    \"type\": \"function\"\n  },\n  {\n    \"inputs\": [],\n    \"name\": \"pollId\",\n    \"outputs\": [\n      {\n        \"internalType\": \"uint256\",\n        \"name\": \"\",\n        \"type\": \"uint256\"\n      }\n    ],\n    \"stateMutability\": \"view\",\n    \"type\": \"function\"\n  },\n  {\n    \"inputs\": [],\n    \"name\": \"questionCID\",\n    \"outputs\": [\n      {\n        \"internalType\": \"string\",\n        \"name\": \"\",\n        \"type\": \"string\"\n      }\n    ],\n    \"stateMutability\": \"view\",\n    \"type\": \"function\"\n  },\n  {\n    \"inputs\": [],\n    \"name\": \"results\",\n    \"outputs\": [\n      {\n        \"internalType\": \"uint256[]\",\n        \"name\": \"\",\n        \"type\": \"uint256[]\"\n      }\n    ],\n    \"stateMutability\": \"view\",\n    \"type\": \"function\"\n  },\n  {\n    \"inputs\": [],\n    \"name\": \"start\",\n    \"outputs\": [\n      {\n        \"internalType\": \"uint64\",\n        \"name\": \"\",\n        \"type\": \"uint64\"\n      }\n    ],\n    \"stateMutability\": \"view\",\n    \"type\": \"function\"\n  },\n  {\n    \"inputs\": [\n      {\n        \"internalType\": \"uint256\",\n        \"name\": \"\",\n        \"type\": \"uint256\"\n      }\n    ],\n    \"name\": \"tallies\",\n    \"outputs\": [\n      {\n        \"internalType\": \"uint256\",\n        \"name\": \"\",\n        \"type\": \"uint256\"\n      }\n    ],\n    \"stateMutability\": \"view\",\n    \"type\": \"function\"\n  },\n  {\n    \"inputs\": [\n      {\n        \"internalType\": \"bytes32\",\n        \"name\": \"\",\n        \"type\": \"bytes32\"\n      }\n    ],\n    \"name\": \"usedNullifier\",\n    \"outputs\": [\n      {\n        \"internalType\": \"bool\",\n        \"name\": \"\",\n        \"type\": \"bool\"\n      }\n    ],\n    \"stateMutability\": \"view\",\n    \"type\": \"function\"\n  },\n  {\n    \"inputs\": [\n      {\n        \"internalType\": \"uint256\",\n        \"name\": \"option\",\n        \"type\": \"uint256\"\n      },\n      {\n        \"internalType\": \"address\",\n        \"name\": \"verifier\",\n        \"type\": \"address\"\n      },\n      {\n        \"internalType\": \"bytes\",\n        \"name\": \"proofData\",\n        \"type\": \"bytes\"\n      }\n    ],\n    \"name\": \"vote\",\n    \"outputs\": [],\n    \"stateMutability\": \"nonpayable\",\n    \"type\": \"function\"\n  }\n] as const;\n\nexport const PollFactoryABI = [\n  {\n    \"anonymous\": false,\n    \"inputs\": [\n      {\n        \"indexed\": true,\n        \"internalType\": \"uint256\",\n        \"name\": \"pollId\",\n        \"type\": \"uint256\"\n      },\n      {\n        \"indexed\": false,\n        \"internalType\": \"address\",\n        \"name\": \"poll\",\n        \"type\": \"address\"\n      },\n      {\n        \"indexed\": false,\n        \"internalType\": \"string\",\n        \"name\": \"questionCID\",\n        \"type\": \"string\"\n      }\n    ],\n    \"name\": \"PollCreated\",\n    \"type\": \"event\"\n  },\n  {\n    \"inputs\": [\n      {\n        \"internalType\": \"string\",\n        \"name\": \"questionCID\",\n        \"type\": \"string\"\n      },\n      {\n        \"internalType\": \"uint64\",\n        \"name\": \"start\",\n        \"type\": \"uint64\"\n      },\n      {\n        \"internalType\": \"uint64\",\n        \"name\": \"end\",\n        \"type\": \"uint64\"\n      },\n      {\n        \"internalType\": \"uint256\",\n        \"name\": \"optionsCount\",\n        \"type\": \"uint256\"\n      },\n      {\n        \"internalType\": \"address\",\n        \"name\": \"aggregator\",\n        \"type\": \"address\"\n      }\n    ],\n    \"name\": \"createAnonPoll\",\n    \"outputs\": [\n      {\n        \"internalType\": \"address\",\n        \"name\": \"poll\",\n        \"type\": \"address\"\n      }\n    ],\n    \"stateMutability\": \"nonpayable\",\n    \"type\": \"function\"\n  },\n  {\n    \"inputs\": [],\n    \"name\": \"nextId\",\n    \"outputs\": [\n      {\n        \"internalType\": \"uint256\",\n        \"name\": \"\",\n        \"type\": \"uint256\"\n      }\n    ],\n    \"stateMutability\": \"view\",\n    \"type\": \"function\"\n  }\n] as const;\n\nexport const EligibilityAggregatorABI = [\n  {\n    \"inputs\": [\n      {\n        \"internalType\": \"address\",\n        \"name\": \"_dao\",\n        \"type\": \"address\"\n      }\n    ],\n    \"stateMutability\": \"nonpayable\",\n    \"type\": \"constructor\"\n  },\n  {\n    \"anonymous\": false,\n    \"inputs\": [\n      {\n        \"indexed\": true,\n        \"internalType\": \"address\",\n        \"name\": \"verifier\",\n        \"type\": \"address\"\n      },\n      {\n        \"indexed\": false,\n        \"internalType\": \"bool\",\n        \"name\": \"allowed\",\n        \"type\": \"bool\"\n      }\n    ],\n    \"name\": \"VerifierUpdated\",\n    \"type\": \"event\"\n  },\n  {\n    \"inputs\": [\n      {\n        \"internalType\": \"uint256\",\n        \"name\": \"pollId\",\n        \"type\": \"uint256\"\n      },\n      {\n        \"internalType\": \"address\",\n        \"name\": \"verifier\",\n        \"type\": \"address\"\n      },\n      {\n        \"internalType\": \"bytes\",\n        \"name\": \"proofData\",\n        \"type\": \"bytes\"\n      }\n    ],\n    \"name\": \"check\",\n    \"outputs\": [\n      {\n        \"internalType\": \"bytes32\",\n        \"name\": \"\",\n        \"type\": \"bytes32\"\n      }\n    ],\n    \"stateMutability\": \"view\",\n    \"type\": \"function\"\n  },\n  {\n    \"inputs\": [],\n    \"name\": \"dao\",\n    \"outputs\": [\n      {\n        \"internalType\": \"address\",\n        \"name\": \"\",\n        \"type\": \"address\"\n      }\n    ],\n    \"stateMutability\": \"view\",\n    \"type\": \"function\"\n  },\n  {\n    \"inputs\": [\n      {\n        \"internalType\": \"address\",\n        \"name\": \"\",\n        \"type\": \"address\"\n      }\n    ],\n    \"name\": \"isVerifier\",\n    \"outputs\": [\n      {\n        \"internalType\": \"bool\",\n        \"name\": \"\",\n        \"type\": \"bool\"\n      }\n    ],\n    \"stateMutability\": \"view\",\n    \"type\": \"function\"\n  },\n  {\n    \"inputs\": [\n      {\n        \"internalType\": \"address\",\n        \"name\": \"verifier\",\n        \"type\": \"address\"\n      },\n      {\n        \"internalType\": \"bool\",\n        \"name\": \"allowed\",\n        \"type\": \"bool\"\n      }\n    ],\n    \"name\": \"setVerifier\",\n    \"outputs\": [],\n    \"stateMutability\": \"nonpayable\",\n    \"type\": \"function\"\n  }\n] as const;\n\nexport const MockSemaphoreVerifierABI = [\n  {\n    \"inputs\": [\n      {\n        \"internalType\": \"uint256\",\n        \"name\": \"pollId\",\n        \"type\": \"uint256\"\n      },\n      {\n        \"internalType\": \"bytes\",\n        \"name\": \"proofData\",\n        \"type\": \"bytes\"\n      }\n    ],\n    \"name\": \"verifyProof\",\n    \"outputs\": [\n      {\n        \"internalType\": \"bytes32\",\n        \"name\": \"nullifier\",\n        \"type\": \"bytes32\"\n      }\n    ],\n    \"stateMutability\": \"pure\",\n    \"type\": \"function\"\n  }\n] as const;\n\n"],"names":[],"mappings":";;;;;;;;;;AAAO,MAAM,cAAc;IACzB;QACE,UAAU;YACR;gBACE,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;YACA;gBACE,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;YACA;gBACE,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;YACA;gBACE,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;YACA;gBACE,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;YACA;gBACE,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;SACD;QACD,mBAAmB;QACnB,QAAQ;IACV;IACA;QACE,aAAa;QACb,UAAU;YACR;gBACE,WAAW;gBACX,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;YACA;gBACE,WAAW;gBACX,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;SACD;QACD,QAAQ;QACR,QAAQ;IACV;IACA;QACE,UAAU,EAAE;QACZ,QAAQ;QACR,WAAW;YACT;gBACE,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;SACD;QACD,mBAAmB;QACnB,QAAQ;IACV;IACA;QACE,UAAU,EAAE;QACZ,QAAQ;QACR,WAAW;YACT;gBACE,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;SACD;QACD,mBAAmB;QACnB,QAAQ;IACV;IACA;QACE,UAAU,EAAE;QACZ,QAAQ;QACR,WAAW;YACT;gBACE,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;SACD;QACD,mBAAmB;QACnB,QAAQ;IACV;IACA;QACE,UAAU,EAAE;QACZ,QAAQ;QACR,WAAW;YACT;gBACE,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;SACD;QACD,mBAAmB;QACnB,QAAQ;IACV;IACA;QACE,UAAU,EAAE;QACZ,QAAQ;QACR,WAAW;YACT;gBACE,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;SACD;QACD,mBAAmB;QACnB,QAAQ;IACV;IACA;QACE,UAAU,EAAE;QACZ,QAAQ;QACR,WAAW;YACT;gBACE,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;SACD;QACD,mBAAmB;QACnB,QAAQ;IACV;IACA;QACE,UAAU;YACR;gBACE,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;SACD;QACD,QAAQ;QACR,WAAW;YACT;gBACE,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;SACD;QACD,mBAAmB;QACnB,QAAQ;IACV;IACA;QACE,UAAU;YACR;gBACE,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;SACD;QACD,QAAQ;QACR,WAAW;YACT;gBACE,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;SACD;QACD,mBAAmB;QACnB,QAAQ;IACV;IACA;QACE,UAAU;YACR;gBACE,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;YACA;gBACE,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;YACA;gBACE,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;SACD;QACD,QAAQ;QACR,WAAW,EAAE;QACb,mBAAmB;QACnB,QAAQ;IACV;CACD;AAEM,MAAM,iBAAiB;IAC5B;QACE,aAAa;QACb,UAAU;YACR;gBACE,WAAW;gBACX,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;YACA;gBACE,WAAW;gBACX,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;YACA;gBACE,WAAW;gBACX,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;SACD;QACD,QAAQ;QACR,QAAQ;IACV;IACA;QACE,UAAU;YACR;gBACE,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;YACA;gBACE,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;YACA;gBACE,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;YACA;gBACE,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;YACA;gBACE,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;SACD;QACD,QAAQ;QACR,WAAW;YACT;gBACE,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;SACD;QACD,mBAAmB;QACnB,QAAQ;IACV;IACA;QACE,UAAU,EAAE;QACZ,QAAQ;QACR,WAAW;YACT;gBACE,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;SACD;QACD,mBAAmB;QACnB,QAAQ;IACV;CACD;AAEM,MAAM,2BAA2B;IACtC;QACE,UAAU;YACR;gBACE,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;SACD;QACD,mBAAmB;QACnB,QAAQ;IACV;IACA;QACE,aAAa;QACb,UAAU;YACR;gBACE,WAAW;gBACX,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;YACA;gBACE,WAAW;gBACX,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;SACD;QACD,QAAQ;QACR,QAAQ;IACV;IACA;QACE,UAAU;YACR;gBACE,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;YACA;gBACE,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;YACA;gBACE,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;SACD;QACD,QAAQ;QACR,WAAW;YACT;gBACE,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;SACD;QACD,mBAAmB;QACnB,QAAQ;IACV;IACA;QACE,UAAU,EAAE;QACZ,QAAQ;QACR,WAAW;YACT;gBACE,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;SACD;QACD,mBAAmB;QACnB,QAAQ;IACV;IACA;QACE,UAAU;YACR;gBACE,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;SACD;QACD,QAAQ;QACR,WAAW;YACT;gBACE,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;SACD;QACD,mBAAmB;QACnB,QAAQ;IACV;IACA;QACE,UAAU;YACR;gBACE,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;YACA;gBACE,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;SACD;QACD,QAAQ;QACR,WAAW,EAAE;QACb,mBAAmB;QACnB,QAAQ;IACV;CACD;AAEM,MAAM,2BAA2B;IACtC;QACE,UAAU;YACR;gBACE,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;YACA;gBACE,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;SACD;QACD,QAAQ;QACR,WAAW;YACT;gBACE,gBAAgB;gBAChB,QAAQ;gBACR,QAAQ;YACV;SACD;QACD,mBAAmB;QACnB,QAAQ;IACV;CACD"}},
    {"offset": {"line": 556, "column": 0}, "map": {"version":3,"sources":["file:///home/blockcode/antigravity/contracts/ui/src/components/VoteForm.tsx"],"sourcesContent":["'use client';\n\nimport { useState } from 'react';\nimport { ethers } from 'ethers';\nimport axios from 'axios';\nimport { useWallet } from './Providers';\nimport { CONFIG } from '@/lib/config';\nimport { AnonPollABI } from '@/lib/abis';\n\ninterface VoteFormProps {\n    pollId: number;\n    pollAddress: string;\n    optionsCount: number;\n    onVoteSuccess: () => void;\n}\n\nexport default function VoteForm({ pollId, pollAddress, optionsCount, onVoteSuccess }: VoteFormProps) {\n    const { provider, account, connect } = useWallet();\n    const [selectedOption, setSelectedOption] = useState<number | null>(null);\n    const [loading, setLoading] = useState(false);\n    const [status, setStatus] = useState('');\n\n    const vote = async () => {\n        if (selectedOption === null) return;\n        if (!provider || !account) {\n            connect();\n            return;\n        }\n\n        setLoading(true);\n        setStatus('Preparing vote...');\n\n        try {\n            const signer = await provider.getSigner();\n\n            // 1. Generate Mock Proof\n            // In real app, this would be a ZK proof generation\n            // MockVerifier expects: abi.encode(address identity, bool valid)\n            const proofData = ethers.AbiCoder.defaultAbiCoder().encode(\n                ['address', 'bool'],\n                [account, true]\n            );\n\n            // 2. Construct Meta-Transaction\n            const pollContract = new ethers.Contract(pollAddress, AnonPollABI, signer);\n\n            // We need to encode the function call: vote(option, verifier, proofData)\n            const data = pollContract.interface.encodeFunctionData(\"vote\", [\n                selectedOption,\n                CONFIG.contracts.MockSemaphoreVerifier,\n                proofData\n            ]);\n\n            // 3. Get Nonce from Forwarder\n            // We need the Forwarder contract to check nonce\n            // But for simplicity, we can ask the relayer or just query chain\n            // Let's query chain using a read-only provider\n            const readProvider = new ethers.JsonRpcProvider(CONFIG.rpcUrl);\n            const forwarderABI = [\n                \"function getNonce(address from) view returns (uint256)\",\n                \"function execute((address from,address to,uint256 value,uint256 gas,uint256 nonce,bytes data), bytes) payable returns (bytes)\"\n            ];\n            const forwarder = new ethers.Contract(CONFIG.contracts.Forwarder, forwarderABI, readProvider);\n            const nonce = await forwarder.getNonce(account);\n\n            // 4. Sign Message (SimpleForwarder expects EthSignedMessageHash of abi.encoded struct)\n            // The contract does:\n            // keccak256(abi.encode(from, to, value, gas, nonce, keccak256(data)))\n\n            const abiCoder = new ethers.AbiCoder();\n            const dataHash = ethers.keccak256(data);\n\n            const structHash = ethers.keccak256(abiCoder.encode(\n                ['address', 'address', 'uint256', 'uint256', 'uint256', 'bytes32'],\n                [account, pollAddress, 0, 500000, Number(nonce), dataHash]\n            ));\n\n            // Sign the hash (ethers.signMessage automatically adds the prefix)\n            // We need to pass the raw bytes of the hash\n            const signature = await signer.signMessage(ethers.getBytes(structHash));\n\n            const req = {\n                from: account,\n                to: pollAddress,\n                value: 0,\n                gas: 500000,\n                nonce: Number(nonce),\n                data: data,\n            };\n\n            // 5. Send to Relayer\n            setStatus('Sending to Relayer...');\n            await axios.post(`${CONFIG.relayerUrl}/relay`, {\n                forwardRequest: req,\n                signature: signature\n            });\n\n            setStatus('Vote relayed! Waiting for mining...');\n            // In a real app, we'd poll for the tx hash returned by relayer\n            // For now, just wait a bit\n            await new Promise(r => setTimeout(r, 2000));\n\n            alert('Vote submitted successfully!');\n            onVoteSuccess();\n        } catch (err: any) {\n            console.error(\"Vote failed:\", err);\n            setStatus(`Error: ${err.message || 'Vote failed'}`);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    return (\n        <div className=\"mt-6\">\n            <h3 className=\"text-lg font-semibold mb-3\">Cast your Vote</h3>\n            <div className=\"space-y-2\">\n                {Array.from({ length: optionsCount }).map((_, idx) => (\n                    <button\n                        key={idx}\n                        onClick={() => setSelectedOption(idx)}\n                        className={`w-full text-left px-4 py-3 rounded-md border transition-colors ${selectedOption === idx\n                            ? 'border-primary bg-primary/10 ring-1 ring-primary'\n                            : 'border-input hover:bg-accent hover:text-accent-foreground'\n                            }`}\n                    >\n                        Option {idx + 1}\n                    </button>\n                ))}\n            </div>\n\n            {status && <p className=\"text-sm text-muted-foreground mt-2\">{status}</p>}\n\n            <button\n                onClick={vote}\n                disabled={loading || selectedOption === null}\n                className=\"mt-4 inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground shadow hover:bg-primary/90 h-9 px-4 py-2 w-full\"\n            >\n                {loading ? 'Voting...' : 'Submit Vote'}\n            </button>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 730, "column": 0}, "map": {"version":3,"sources":["file:///home/blockcode/antigravity/contracts/ui/src/app/polls/%5Bid%5D/page.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useState } from 'react';\nimport { useParams } from 'next/navigation';\nimport { ethers } from 'ethers';\nimport { CONFIG } from '@/lib/config';\nimport { PollFactoryABI, AnonPollABI } from '@/lib/abis';\nimport { useWallet } from '@/components/Providers';\nimport VoteForm from '@/components/VoteForm';\n\ninterface PollDetails {\n    id: number;\n    address: string;\n    question: string;\n    start: number;\n    end: number;\n    tallies: number[];\n    optionsCount: number;\n}\n\nexport default function PollPage() {\n    const params = useParams();\n    const { provider } = useWallet();\n    const [poll, setPoll] = useState<PollDetails | null>(null);\n    const [loading, setLoading] = useState(true);\n\n    const fetchPoll = async () => {\n        try {\n            const pollId = Number(params.id);\n            const readProvider = provider || new ethers.JsonRpcProvider(CONFIG.rpcUrl);\n\n            // We need to find the poll address from the factory events or by querying the factory if it had a mapping\n            // The factory emits PollCreated(id, address, cid)\n            // We can query filter for that specific ID\n            const factory = new ethers.Contract(CONFIG.contracts.PollFactory, PollFactoryABI, readProvider);\n            const filter = factory.filters.PollCreated(pollId);\n            const events = await factory.queryFilter(filter);\n\n            if (events.length === 0) {\n                setLoading(false);\n                return;\n            }\n\n            const event: any = events[0];\n            const pollAddress = event.args.poll;\n            const questionCID = event.args.questionCID;\n\n            const pollContract = new ethers.Contract(pollAddress, AnonPollABI, readProvider);\n            const start = await pollContract.start();\n            const end = await pollContract.end();\n            const tallies = await pollContract.results(); // uint256[]\n\n            setPoll({\n                id: pollId,\n                address: pollAddress,\n                question: questionCID,\n                start: Number(start),\n                end: Number(end),\n                tallies: tallies.map((t: any) => Number(t)),\n                optionsCount: tallies.length\n            });\n        } catch (err) {\n            console.error(\"Error fetching poll:\", err);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    useEffect(() => {\n        fetchPoll();\n    }, [params.id, provider]);\n\n    if (loading) return <div>Loading poll...</div>;\n    if (!poll) return <div>Poll not found</div>;\n\n    const now = Math.floor(Date.now() / 1000);\n    const isActive = now >= poll.start && now <= poll.end;\n    const isEnded = now > poll.end;\n\n    return (\n        <div className=\"max-w-2xl mx-auto\">\n            <div className=\"mb-8\">\n                <h1 className=\"text-3xl font-bold mb-2\">{poll.question}</h1>\n                <div className=\"flex gap-4 text-sm text-muted-foreground\">\n                    <span>ID: {poll.id}</span>\n                    <span>Status: {isActive ? 'Active' : (isEnded ? 'Ended' : 'Upcoming')}</span>\n                </div>\n            </div>\n\n            <div className=\"grid gap-6\">\n                <div className=\"rounded-lg border bg-card text-card-foreground shadow-sm p-6\">\n                    <h2 className=\"text-xl font-semibold mb-4\">Results</h2>\n                    <div className=\"space-y-4\">\n                        {poll.tallies.map((count, idx) => (\n                            <div key={idx} className=\"space-y-1\">\n                                <div className=\"flex justify-between text-sm\">\n                                    <span>Option {idx + 1}</span>\n                                    <span className=\"font-medium\">{count} votes</span>\n                                </div>\n                                <div className=\"h-2 w-full rounded-full bg-secondary\">\n                                    <div\n                                        className=\"h-full rounded-full bg-primary transition-all\"\n                                        style={{\n                                            width: `${poll.tallies.reduce((a, b) => a + b, 0) > 0\n                                                ? (count / poll.tallies.reduce((a, b) => a + b, 0)) * 100\n                                                : 0}%`\n                                        }}\n                                    />\n                                </div>\n                            </div>\n                        ))}\n                    </div>\n                </div>\n\n                {isActive && (\n                    <div className=\"rounded-lg border bg-card text-card-foreground shadow-sm p-6\">\n                        <VoteForm\n                            pollId={poll.id}\n                            pollAddress={poll.address}\n                            optionsCount={poll.optionsCount}\n                            onVoteSuccess={fetchPoll}\n                        />\n                    </div>\n                )}\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}}]
}