{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/blockcode/antigravity/contracts/ui/src/lib/abis.ts"],"sourcesContent":["export const AnonPollABI = [\n  {\n    \"inputs\": [\n      {\n        \"internalType\": \"uint256\",\n        \"name\": \"_pollId\",\n        \"type\": \"uint256\"\n      },\n      {\n        \"internalType\": \"string\",\n        \"name\": \"_questionCID\",\n        \"type\": \"string\"\n      },\n      {\n        \"internalType\": \"uint64\",\n        \"name\": \"_start\",\n        \"type\": \"uint64\"\n      },\n      {\n        \"internalType\": \"uint64\",\n        \"name\": \"_end\",\n        \"type\": \"uint64\"\n      },\n      {\n        \"internalType\": \"uint256\",\n        \"name\": \"optionsCount\",\n        \"type\": \"uint256\"\n      },\n      {\n        \"internalType\": \"address\",\n        \"name\": \"_aggregator\",\n        \"type\": \"address\"\n      }\n    ],\n    \"stateMutability\": \"nonpayable\",\n    \"type\": \"constructor\"\n  },\n  {\n    \"anonymous\": false,\n    \"inputs\": [\n      {\n        \"indexed\": true,\n        \"internalType\": \"bytes32\",\n        \"name\": \"nullifier\",\n        \"type\": \"bytes32\"\n      },\n      {\n        \"indexed\": false,\n        \"internalType\": \"uint256\",\n        \"name\": \"option\",\n        \"type\": \"uint256\"\n      }\n    ],\n    \"name\": \"Voted\",\n    \"type\": \"event\"\n  },\n  {\n    \"inputs\": [],\n    \"name\": \"aggregator\",\n    \"outputs\": [\n      {\n        \"internalType\": \"address\",\n        \"name\": \"\",\n        \"type\": \"address\"\n      }\n    ],\n    \"stateMutability\": \"view\",\n    \"type\": \"function\"\n  },\n  {\n    \"inputs\": [],\n    \"name\": \"end\",\n    \"outputs\": [\n      {\n        \"internalType\": \"uint64\",\n        \"name\": \"\",\n        \"type\": \"uint64\"\n      }\n    ],\n    \"stateMutability\": \"view\",\n    \"type\": \"function\"\n  },\n  {\n    \"inputs\": [],\n    \"name\": \"pollId\",\n    \"outputs\": [\n      {\n        \"internalType\": \"uint256\",\n        \"name\": \"\",\n        \"type\": \"uint256\"\n      }\n    ],\n    \"stateMutability\": \"view\",\n    \"type\": \"function\"\n  },\n  {\n    \"inputs\": [],\n    \"name\": \"questionCID\",\n    \"outputs\": [\n      {\n        \"internalType\": \"string\",\n        \"name\": \"\",\n        \"type\": \"string\"\n      }\n    ],\n    \"stateMutability\": \"view\",\n    \"type\": \"function\"\n  },\n  {\n    \"inputs\": [],\n    \"name\": \"results\",\n    \"outputs\": [\n      {\n        \"internalType\": \"uint256[]\",\n        \"name\": \"\",\n        \"type\": \"uint256[]\"\n      }\n    ],\n    \"stateMutability\": \"view\",\n    \"type\": \"function\"\n  },\n  {\n    \"inputs\": [],\n    \"name\": \"start\",\n    \"outputs\": [\n      {\n        \"internalType\": \"uint64\",\n        \"name\": \"\",\n        \"type\": \"uint64\"\n      }\n    ],\n    \"stateMutability\": \"view\",\n    \"type\": \"function\"\n  },\n  {\n    \"inputs\": [\n      {\n        \"internalType\": \"uint256\",\n        \"name\": \"\",\n        \"type\": \"uint256\"\n      }\n    ],\n    \"name\": \"tallies\",\n    \"outputs\": [\n      {\n        \"internalType\": \"uint256\",\n        \"name\": \"\",\n        \"type\": \"uint256\"\n      }\n    ],\n    \"stateMutability\": \"view\",\n    \"type\": \"function\"\n  },\n  {\n    \"inputs\": [\n      {\n        \"internalType\": \"bytes32\",\n        \"name\": \"\",\n        \"type\": \"bytes32\"\n      }\n    ],\n    \"name\": \"usedNullifier\",\n    \"outputs\": [\n      {\n        \"internalType\": \"bool\",\n        \"name\": \"\",\n        \"type\": \"bool\"\n      }\n    ],\n    \"stateMutability\": \"view\",\n    \"type\": \"function\"\n  },\n  {\n    \"inputs\": [\n      {\n        \"internalType\": \"uint256\",\n        \"name\": \"option\",\n        \"type\": \"uint256\"\n      },\n      {\n        \"internalType\": \"address\",\n        \"name\": \"verifier\",\n        \"type\": \"address\"\n      },\n      {\n        \"internalType\": \"bytes\",\n        \"name\": \"proofData\",\n        \"type\": \"bytes\"\n      }\n    ],\n    \"name\": \"vote\",\n    \"outputs\": [],\n    \"stateMutability\": \"nonpayable\",\n    \"type\": \"function\"\n  }\n] as const;\n\nexport const PollFactoryABI = [\n  {\n    \"anonymous\": false,\n    \"inputs\": [\n      {\n        \"indexed\": true,\n        \"internalType\": \"uint256\",\n        \"name\": \"pollId\",\n        \"type\": \"uint256\"\n      },\n      {\n        \"indexed\": false,\n        \"internalType\": \"address\",\n        \"name\": \"poll\",\n        \"type\": \"address\"\n      },\n      {\n        \"indexed\": false,\n        \"internalType\": \"string\",\n        \"name\": \"questionCID\",\n        \"type\": \"string\"\n      }\n    ],\n    \"name\": \"PollCreated\",\n    \"type\": \"event\"\n  },\n  {\n    \"inputs\": [\n      {\n        \"internalType\": \"string\",\n        \"name\": \"questionCID\",\n        \"type\": \"string\"\n      },\n      {\n        \"internalType\": \"uint64\",\n        \"name\": \"start\",\n        \"type\": \"uint64\"\n      },\n      {\n        \"internalType\": \"uint64\",\n        \"name\": \"end\",\n        \"type\": \"uint64\"\n      },\n      {\n        \"internalType\": \"uint256\",\n        \"name\": \"optionsCount\",\n        \"type\": \"uint256\"\n      },\n      {\n        \"internalType\": \"address\",\n        \"name\": \"aggregator\",\n        \"type\": \"address\"\n      }\n    ],\n    \"name\": \"createAnonPoll\",\n    \"outputs\": [\n      {\n        \"internalType\": \"address\",\n        \"name\": \"poll\",\n        \"type\": \"address\"\n      }\n    ],\n    \"stateMutability\": \"nonpayable\",\n    \"type\": \"function\"\n  },\n  {\n    \"inputs\": [],\n    \"name\": \"nextId\",\n    \"outputs\": [\n      {\n        \"internalType\": \"uint256\",\n        \"name\": \"\",\n        \"type\": \"uint256\"\n      }\n    ],\n    \"stateMutability\": \"view\",\n    \"type\": \"function\"\n  }\n] as const;\n\nexport const EligibilityAggregatorABI = [\n  {\n    \"inputs\": [\n      {\n        \"internalType\": \"address\",\n        \"name\": \"_dao\",\n        \"type\": \"address\"\n      }\n    ],\n    \"stateMutability\": \"nonpayable\",\n    \"type\": \"constructor\"\n  },\n  {\n    \"anonymous\": false,\n    \"inputs\": [\n      {\n        \"indexed\": true,\n        \"internalType\": \"address\",\n        \"name\": \"verifier\",\n        \"type\": \"address\"\n      },\n      {\n        \"indexed\": false,\n        \"internalType\": \"bool\",\n        \"name\": \"allowed\",\n        \"type\": \"bool\"\n      }\n    ],\n    \"name\": \"VerifierUpdated\",\n    \"type\": \"event\"\n  },\n  {\n    \"inputs\": [\n      {\n        \"internalType\": \"uint256\",\n        \"name\": \"pollId\",\n        \"type\": \"uint256\"\n      },\n      {\n        \"internalType\": \"address\",\n        \"name\": \"verifier\",\n        \"type\": \"address\"\n      },\n      {\n        \"internalType\": \"bytes\",\n        \"name\": \"proofData\",\n        \"type\": \"bytes\"\n      }\n    ],\n    \"name\": \"check\",\n    \"outputs\": [\n      {\n        \"internalType\": \"bytes32\",\n        \"name\": \"\",\n        \"type\": \"bytes32\"\n      }\n    ],\n    \"stateMutability\": \"view\",\n    \"type\": \"function\"\n  },\n  {\n    \"inputs\": [],\n    \"name\": \"dao\",\n    \"outputs\": [\n      {\n        \"internalType\": \"address\",\n        \"name\": \"\",\n        \"type\": \"address\"\n      }\n    ],\n    \"stateMutability\": \"view\",\n    \"type\": \"function\"\n  },\n  {\n    \"inputs\": [\n      {\n        \"internalType\": \"address\",\n        \"name\": \"\",\n        \"type\": \"address\"\n      }\n    ],\n    \"name\": \"isVerifier\",\n    \"outputs\": [\n      {\n        \"internalType\": \"bool\",\n        \"name\": \"\",\n        \"type\": \"bool\"\n      }\n    ],\n    \"stateMutability\": \"view\",\n    \"type\": \"function\"\n  },\n  {\n    \"inputs\": [\n      {\n        \"internalType\": \"address\",\n        \"name\": \"verifier\",\n        \"type\": \"address\"\n      },\n      {\n        \"internalType\": \"bool\",\n        \"name\": \"allowed\",\n        \"type\": \"bool\"\n      }\n    ],\n    \"name\": \"setVerifier\",\n    \"outputs\": [],\n    \"stateMutability\": \"nonpayable\",\n    \"type\": \"function\"\n  }\n] as const;\n\nexport const MockSemaphoreVerifierABI = [\n  {\n    \"inputs\": [\n      {\n        \"internalType\": \"uint256\",\n        \"name\": \"pollId\",\n        \"type\": \"uint256\"\n      },\n      {\n        \"internalType\": \"bytes\",\n        \"name\": \"proofData\",\n        \"type\": \"bytes\"\n      }\n    ],\n    \"name\": \"verifyProof\",\n    \"outputs\": [\n      {\n        \"internalType\": \"bytes32\",\n        \"name\": \"nullifier\",\n        \"type\": \"bytes32\"\n      }\n    ],\n    \"stateMutability\": \"pure\",\n    \"type\": \"function\"\n  }\n] as const;\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 433, "column": 0}, "map": {"version":3,"sources":["file:///home/blockcode/antigravity/contracts/ui/src/components/VoteForm.tsx"],"sourcesContent":["'use client';\n\nimport { useState } from 'react';\nimport { ethers } from 'ethers';\nimport axios from 'axios';\nimport { useWallet } from './Providers';\nimport { CONFIG } from '@/lib/config';\nimport { AnonPollABI } from '@/lib/abis';\n\ninterface VoteFormProps {\n    pollId: number;\n    pollAddress: string;\n    optionsCount: number;\n    onVoteSuccess: () => void;\n}\n\nexport default function VoteForm({ pollId, pollAddress, optionsCount, onVoteSuccess }: VoteFormProps) {\n    const { provider, account, connect } = useWallet();\n    const [selectedOption, setSelectedOption] = useState<number | null>(null);\n    const [loading, setLoading] = useState(false);\n    const [status, setStatus] = useState('');\n\n    const vote = async () => {\n        if (selectedOption === null) return;\n        if (!provider || !account) {\n            connect();\n            return;\n        }\n\n        setLoading(true);\n        setStatus('Preparing vote...');\n\n        try {\n            const signer = await provider.getSigner();\n\n            // 1. Generate Mock Proof\n            // In real app, this would be a ZK proof generation\n            // MockVerifier expects: abi.encode(address identity, bool valid)\n            const proofData = ethers.AbiCoder.defaultAbiCoder().encode(\n                ['address', 'bool'],\n                [account, true]\n            );\n\n            // 2. Construct Meta-Transaction\n            const pollContract = new ethers.Contract(pollAddress, AnonPollABI, signer);\n\n            // We need to encode the function call: vote(option, verifier, proofData)\n            const data = pollContract.interface.encodeFunctionData(\"vote\", [\n                selectedOption,\n                CONFIG.contracts.MockSemaphoreVerifier,\n                proofData\n            ]);\n\n            // 3. Get Nonce from Forwarder\n            // We need the Forwarder contract to check nonce\n            // But for simplicity, we can ask the relayer or just query chain\n            // Let's query chain using a read-only provider\n            const readProvider = new ethers.JsonRpcProvider(CONFIG.rpcUrl);\n            const forwarderABI = [\n                \"function getNonce(address from) view returns (uint256)\",\n                \"function execute((address from,address to,uint256 value,uint256 gas,uint256 nonce,bytes data), bytes) payable returns (bytes)\"\n            ];\n            const forwarder = new ethers.Contract(CONFIG.contracts.Forwarder, forwarderABI, readProvider);\n            const nonce = await forwarder.getNonce(account);\n\n            // 4. Sign Message (SimpleForwarder expects EthSignedMessageHash of abi.encoded struct)\n            // The contract does:\n            // keccak256(abi.encode(from, to, value, gas, nonce, keccak256(data)))\n\n            const abiCoder = new ethers.AbiCoder();\n            const dataHash = ethers.keccak256(data);\n\n            const structHash = ethers.keccak256(abiCoder.encode(\n                ['address', 'address', 'uint256', 'uint256', 'uint256', 'bytes32'],\n                [account, pollAddress, 0, 500000, Number(nonce), dataHash]\n            ));\n\n            // Sign the hash (ethers.signMessage automatically adds the prefix)\n            // We need to pass the raw bytes of the hash\n            const signature = await signer.signMessage(ethers.getBytes(structHash));\n\n            const req = {\n                from: account,\n                to: pollAddress,\n                value: 0,\n                gas: 500000,\n                nonce: Number(nonce),\n                data: data,\n            };\n\n            // 5. Send to Relayer\n            setStatus('Sending to Relayer...');\n            await axios.post(`${CONFIG.relayerUrl}/relay`, {\n                forwardRequest: req,\n                signature: signature\n            });\n\n            setStatus('Vote relayed! Waiting for mining...');\n            // In a real app, we'd poll for the tx hash returned by relayer\n            // For now, just wait a bit\n            await new Promise(r => setTimeout(r, 2000));\n\n            alert('Vote submitted successfully!');\n            onVoteSuccess();\n        } catch (err: any) {\n            console.error(\"Vote failed:\", err);\n            setStatus(`Error: ${err.message || 'Vote failed'}`);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    return (\n        <div className=\"mt-6\">\n            <h3 className=\"text-lg font-semibold mb-3\">Cast your Vote</h3>\n            <div className=\"space-y-2\">\n                {Array.from({ length: optionsCount }).map((_, idx) => (\n                    <button\n                        key={idx}\n                        onClick={() => setSelectedOption(idx)}\n                        className={`w-full text-left px-4 py-3 rounded-md border transition-colors ${selectedOption === idx\n                            ? 'border-primary bg-primary/10 ring-1 ring-primary'\n                            : 'border-input hover:bg-accent hover:text-accent-foreground'\n                            }`}\n                    >\n                        Option {idx + 1}\n                    </button>\n                ))}\n            </div>\n\n            {status && <p className=\"text-sm text-muted-foreground mt-2\">{status}</p>}\n\n            <button\n                onClick={vote}\n                disabled={loading || selectedOption === null}\n                className=\"mt-4 inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground shadow hover:bg-primary/90 h-9 px-4 py-2 w-full\"\n            >\n                {loading ? 'Voting...' : 'Submit Vote'}\n            </button>\n        </div>\n    );\n}\n"],"names":["useState","ethers","axios","useWallet","CONFIG","AnonPollABI","VoteFormProps","pollId","pollAddress","optionsCount","onVoteSuccess","VoteForm","provider","account","connect","selectedOption","setSelectedOption","loading","setLoading","status","setStatus","vote","signer","getSigner","proofData","AbiCoder","defaultAbiCoder","encode","pollContract","Contract","data","interface","encodeFunctionData","contracts","MockSemaphoreVerifier","readProvider","JsonRpcProvider","rpcUrl","forwarderABI","forwarder","Forwarder","nonce","getNonce","abiCoder","dataHash","keccak256","structHash","Number","signature","signMessage","getBytes","req","from","to","value","gas","post","relayerUrl","forwardRequest","Promise","r","setTimeout","alert","err","console","error","message","Array","length","map","_","idx"],"mappings":"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","ignoreList":[]}},
    {"offset": {"line": 620, "column": 0}, "map": {"version":3,"sources":["file:///home/blockcode/antigravity/contracts/ui/src/app/polls/%5Bid%5D/page.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useState } from 'react';\nimport { useParams } from 'next/navigation';\nimport { ethers } from 'ethers';\nimport { CONFIG } from '@/lib/config';\nimport { PollFactoryABI, AnonPollABI } from '@/lib/abis';\nimport { useWallet } from '@/components/Providers';\nimport VoteForm from '@/components/VoteForm';\n\ninterface PollDetails {\n    id: number;\n    address: string;\n    question: string;\n    start: number;\n    end: number;\n    tallies: number[];\n    optionsCount: number;\n}\n\nexport default function PollPage() {\n    const params = useParams();\n    const { provider } = useWallet();\n    const [poll, setPoll] = useState<PollDetails | null>(null);\n    const [loading, setLoading] = useState(true);\n\n    const fetchPoll = async () => {\n        try {\n            const pollId = Number(params.id);\n            const readProvider = provider || new ethers.JsonRpcProvider(CONFIG.rpcUrl);\n\n            // We need to find the poll address from the factory events or by querying the factory if it had a mapping\n            // The factory emits PollCreated(id, address, cid)\n            // We can query filter for that specific ID\n            const factory = new ethers.Contract(CONFIG.contracts.PollFactory, PollFactoryABI, readProvider);\n            const filter = factory.filters.PollCreated(pollId);\n            const events = await factory.queryFilter(filter);\n\n            if (events.length === 0) {\n                setLoading(false);\n                return;\n            }\n\n            const event: any = events[0];\n            const pollAddress = event.args.poll;\n            const questionCID = event.args.questionCID;\n\n            const pollContract = new ethers.Contract(pollAddress, AnonPollABI, readProvider);\n            const start = await pollContract.start();\n            const end = await pollContract.end();\n            const tallies = await pollContract.results(); // uint256[]\n\n            setPoll({\n                id: pollId,\n                address: pollAddress,\n                question: questionCID,\n                start: Number(start),\n                end: Number(end),\n                tallies: tallies.map((t: any) => Number(t)),\n                optionsCount: tallies.length\n            });\n        } catch (err) {\n            console.error(\"Error fetching poll:\", err);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    useEffect(() => {\n        fetchPoll();\n    }, [params.id, provider]);\n\n    if (loading) return <div>Loading poll...</div>;\n    if (!poll) return <div>Poll not found</div>;\n\n    const now = Math.floor(Date.now() / 1000);\n    const isActive = now >= poll.start && now <= poll.end;\n    const isEnded = now > poll.end;\n\n    return (\n        <div className=\"max-w-2xl mx-auto\">\n            <div className=\"mb-8\">\n                <h1 className=\"text-3xl font-bold mb-2\">{poll.question}</h1>\n                <div className=\"flex gap-4 text-sm text-muted-foreground\">\n                    <span>ID: {poll.id}</span>\n                    <span>Status: {isActive ? 'Active' : (isEnded ? 'Ended' : 'Upcoming')}</span>\n                </div>\n            </div>\n\n            <div className=\"grid gap-6\">\n                <div className=\"rounded-lg border bg-card text-card-foreground shadow-sm p-6\">\n                    <h2 className=\"text-xl font-semibold mb-4\">Results</h2>\n                    <div className=\"space-y-4\">\n                        {poll.tallies.map((count, idx) => (\n                            <div key={idx} className=\"space-y-1\">\n                                <div className=\"flex justify-between text-sm\">\n                                    <span>Option {idx + 1}</span>\n                                    <span className=\"font-medium\">{count} votes</span>\n                                </div>\n                                <div className=\"h-2 w-full rounded-full bg-secondary\">\n                                    <div\n                                        className=\"h-full rounded-full bg-primary transition-all\"\n                                        style={{\n                                            width: `${poll.tallies.reduce((a, b) => a + b, 0) > 0\n                                                ? (count / poll.tallies.reduce((a, b) => a + b, 0)) * 100\n                                                : 0}%`\n                                        }}\n                                    />\n                                </div>\n                            </div>\n                        ))}\n                    </div>\n                </div>\n\n                {isActive && (\n                    <div className=\"rounded-lg border bg-card text-card-foreground shadow-sm p-6\">\n                        <VoteForm\n                            pollId={poll.id}\n                            pollAddress={poll.address}\n                            optionsCount={poll.optionsCount}\n                            onVoteSuccess={fetchPoll}\n                        />\n                    </div>\n                )}\n            </div>\n        </div>\n    );\n}\n"],"names":["useEffect","useState","useParams","ethers","CONFIG","PollFactoryABI","AnonPollABI","useWallet","VoteForm","PollDetails","id","address","question","start","end","tallies","optionsCount","PollPage","params","provider","poll","setPoll","loading","setLoading","fetchPoll","pollId","Number","readProvider","JsonRpcProvider","rpcUrl","factory","Contract","contracts","PollFactory","filter","filters","PollCreated","events","queryFilter","length","event","pollAddress","args","questionCID","pollContract","results","map","t","err","console","error","now","Math","floor","Date","isActive","isEnded","count","idx","width","reduce","a","b"],"mappings":"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","ignoreList":[]}}]
}