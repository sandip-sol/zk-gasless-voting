{"version":3,"sources":["../../../../../../../antigravity/contracts/ui/src/components/PollList.tsx","../../../../../../../antigravity/contracts/ui/src/components/CreatePoll.tsx","../../../../../../../antigravity/contracts/ui/src/app/page.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useState } from 'react';\nimport { ethers } from 'ethers';\nimport Link from 'next/link';\nimport { CONFIG } from '@/lib/config';\nimport { PollFactoryABI, AnonPollABI } from '@/lib/abis';\nimport { useWallet } from './Providers';\n\ninterface Poll {\n    id: number;\n    address: string;\n    question: string;\n    start: number;\n    end: number;\n}\n\nexport default function PollList() {\n    const { provider } = useWallet();\n    const [polls, setPolls] = useState<Poll[]>([]);\n    const [loading, setLoading] = useState(true);\n\n    useEffect(() => {\n        const fetchPolls = async () => {\n            try {\n                // Use a read-only provider if wallet not connected\n                const readProvider = provider || new ethers.JsonRpcProvider(CONFIG.rpcUrl);\n                const factory = new ethers.Contract(CONFIG.contracts.PollFactory, PollFactoryABI, readProvider);\n\n                // Fetch PollCreated events\n                // In a real app, we'd cache this or use a subgraph\n                const filter = factory.filters.PollCreated();\n                const events = await factory.queryFilter(filter);\n\n                const loadedPolls = await Promise.all(events.map(async (event: any) => {\n                    const { pollId, poll: pollAddress, questionCID } = event.args;\n\n                    // Fetch details from the poll contract\n                    const pollContract = new ethers.Contract(pollAddress, AnonPollABI, readProvider);\n                    const start = await pollContract.start();\n                    const end = await pollContract.end();\n\n                    // In a real app, we'd fetch the question from IPFS using questionCID\n                    // Here we assume questionCID is the question text for simplicity or we mock it\n                    const question = questionCID;\n\n                    return {\n                        id: Number(pollId),\n                        address: pollAddress,\n                        question,\n                        start: Number(start),\n                        end: Number(end)\n                    };\n                }));\n\n                setPolls(loadedPolls.reverse()); // Show newest first\n            } catch (err) {\n                console.error(\"Error fetching polls:\", err);\n            } finally {\n                setLoading(false);\n            }\n        };\n\n        fetchPolls();\n    }, [provider]);\n\n    if (loading) return <div>Loading polls...</div>;\n\n    return (\n        <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n            {polls.map((poll) => (\n                <Link key={poll.id} href={`/polls/${poll.id}`} className=\"block group\">\n                    <div className=\"rounded-lg border bg-card text-card-foreground shadow-sm hover:shadow-md transition-shadow p-6\">\n                        <h3 className=\"text-lg font-semibold mb-2 group-hover:text-primary transition-colors\">{poll.question}</h3>\n                        <div className=\"text-sm text-muted-foreground\">\n                            <p>Poll ID: {poll.id}</p>\n                            <p>Ends: {new Date(poll.end * 1000).toLocaleDateString()}</p>\n                        </div>\n                    </div>\n                </Link>\n            ))}\n            {polls.length === 0 && (\n                <div className=\"col-span-full text-center text-muted-foreground\">\n                    No polls found. Create one!\n                </div>\n            )}\n        </div>\n    );\n}\n","'use client';\n\nimport { useState } from 'react';\nimport { ethers } from 'ethers';\nimport { useWallet } from './Providers';\nimport { CONFIG } from '@/lib/config';\nimport { PollFactoryABI } from '@/lib/abis';\n\nexport default function CreatePoll() {\n    const { provider, account, connect } = useWallet();\n    const [question, setQuestion] = useState('');\n    const [optionsCount, setOptionsCount] = useState(2);\n    const [duration, setDuration] = useState(3600); // 1 hour\n    const [loading, setLoading] = useState(false);\n\n    const createPoll = async (e: React.FormEvent) => {\n        e.preventDefault();\n        if (!provider || !account) {\n            connect();\n            return;\n        }\n\n        setLoading(true);\n        try {\n            const signer = await provider.getSigner();\n            const factory = new ethers.Contract(CONFIG.contracts.PollFactory, PollFactoryABI, signer);\n\n            const start = Math.floor(Date.now() / 1000);\n            const end = start + duration;\n\n            // In a real app, we'd upload question to IPFS and get CID\n            // Here we just use the text as the CID\n            const tx = await factory.createAnonPoll(\n                question,\n                start,\n                end,\n                optionsCount,\n                CONFIG.contracts.EligibilityAggregator\n            );\n\n            await tx.wait();\n            alert('Poll created successfully!');\n            setQuestion('');\n            // Ideally refresh list or redirect\n            window.location.reload();\n        } catch (err) {\n            console.error(\"Failed to create poll:\", err);\n            alert('Failed to create poll');\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    return (\n        <div className=\"rounded-lg border bg-card text-card-foreground shadow-sm p-6\">\n            <h2 className=\"text-2xl font-bold mb-4\">Create Poll</h2>\n            <form onSubmit={createPoll} className=\"space-y-4\">\n                <div>\n                    <label className=\"block text-sm font-medium mb-1\">Question</label>\n                    <input\n                        type=\"text\"\n                        value={question}\n                        onChange={(e) => setQuestion(e.target.value)}\n                        className=\"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50\"\n                        required\n                    />\n                </div>\n                <div>\n                    <label className=\"block text-sm font-medium mb-1\">Options Count</label>\n                    <input\n                        type=\"number\"\n                        min=\"2\"\n                        value={optionsCount}\n                        onChange={(e) => setOptionsCount(parseInt(e.target.value))}\n                        className=\"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50\"\n                        required\n                    />\n                </div>\n                <div>\n                    <label className=\"block text-sm font-medium mb-1\">Duration (seconds)</label>\n                    <input\n                        type=\"number\"\n                        min=\"60\"\n                        value={duration}\n                        onChange={(e) => setDuration(parseInt(e.target.value))}\n                        className=\"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50\"\n                        required\n                    />\n                </div>\n                <button\n                    type=\"submit\"\n                    disabled={loading}\n                    className=\"inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground shadow hover:bg-primary/90 h-9 px-4 py-2 w-full\"\n                >\n                    {loading ? 'Creating...' : 'Create Poll'}\n                </button>\n            </form>\n        </div>\n    );\n}\n","'use client';\n\nimport PollList from '@/components/PollList';\nimport CreatePoll from '@/components/CreatePoll';\n\nexport default function Home() {\n  return (\n    <div className=\"space-y-8\">\n      <section>\n        <div className=\"flex items-center justify-between mb-6\">\n          <h1 className=\"text-3xl font-bold tracking-tight\">Active Polls</h1>\n        </div>\n        <PollList />\n      </section>\n\n      <section className=\"border-t pt-8\">\n        <CreatePoll />\n      </section>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}